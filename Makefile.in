#
# parameters for the GNU readline(3) library, used to
# build rmidish (front-end to midish)
#
READLINE_INCLUDE = @readline_include@	# extra headers path
READLINE_LIB = @readline_lib@		# extra libraries path

#
# extra parameters
#
INCLUDE = @include@	# extra includes
LIB = @lib@		# extra libs
DEFS = @defs@ 		# extra defines

#
# binaries, documentation, man pages and examples will be installed in 
# ${BIN_DIR}, ${MAN1_DIR}, ${DOC_DIR} and ${EXAMPLES_DIR}
#
BIN_DIR = @bindir@
MAN1_DIR = @mandir@/man1
DOC_DIR = @datadir@/doc/midish
EXAMPLES_DIR = @datadir@/examples/midish

#
# programs to build and install
#
PROGS = @progs@

all:		${PROGS}

install:	${PROGS}
		mkdir -p ${DESTDIR}${BIN_DIR} ${DESTDIR}${MAN1_DIR} \
		    ${DESTDIR}${DOC_DIR} ${DESTDIR}${EXAMPLES_DIR}
		cp ${PROGS} smfplay smfrec ${DESTDIR}${BIN_DIR}
		cp ${PROGS:=.1} smfplay.1 smfrec.1 ${DESTDIR}${MAN1_DIR}
		cp README manual.html ${DESTDIR}${DOC_DIR}
		cp midishrc sample.sng ${DESTDIR}${EXAMPLES_DIR}

check:		midish
		cd regress && ./run-test *.cmd

clean:
		rm -f -- ${PROGS} *.o *~ *.bak *.tmp *.ln *.s *.out *.core core
		cd regress && rm -f -- *~ *.tmp? *.core *.log *.diff *.orig *.rej

distclean:	clean
		rm -f -- Makefile

# ---------------------------------------------------------- dependencies ---

MIDISH_OBJS = \
builtin.o cons.o conv.o data.o dbg.o ev.o exec.o filt.o frame.o lex.o \
main.o mdep.o mdep_raw.o mdep_alsa.o mdep_sndio.o metro.o mididev.o \
mixout.o mux.o name.o node.o norm.o parse.o pool.o saveload.o smf.o song.o \
state.o str.o sysex.o textio.o timo.o track.o user.o 

midish:		${MIDISH_OBJS}
		${CC} ${LDFLAGS} ${MIDISH_OBJS} -o midish ${LIB}

rmidish:	rmidish.c
		${CC} ${CFLAGS} ${READLINE_INCLUDE} rmidish.c \
		${LDFLAGS} -o rmidish ${READLINE_LIB} -lreadline -ltermcap

.c.o:
		${CC} ${CFLAGS} ${INCLUDE} ${DEFS} -c $<

builtin.o:	builtin.c dbg.h defs.h node.h exec.h name.h str.h data.h \
		cons.h frame.h state.h ev.h song.h track.h filt.h \
		sysex.h metro.h timo.h user.h smf.h saveload.h textio.h \
		mux.h mididev.h norm.h builtin.h
cons.o:		cons.c dbg.h textio.h cons.h user.h
conv.o:		conv.c dbg.h state.h ev.h defs.h conv.h
data.o:		data.c dbg.h str.h cons.h data.h
dbg.o:		dbg.c dbg.h
ev.o:		ev.c dbg.h ev.h defs.h str.h cons.h
exec.o:		exec.c dbg.h exec.h name.h str.h data.h node.h cons.h
filt.o:		filt.c dbg.h ev.h defs.h filt.h pool.h mux.h cons.h
frame.o:	frame.c dbg.h track.h ev.h defs.h frame.h state.h pool.h
lex.o:		lex.c dbg.h lex.h str.h textio.h cons.h
main.o:		main.c dbg.h str.h cons.h ev.h defs.h mux.h track.h \
		frame.h state.h song.h name.h filt.h sysex.h metro.h \
		timo.h user.h mididev.h textio.h
mdep.o:		mdep.c defs.h mux.h mididev.h cons.h user.h exec.h \
		name.h str.h dbg.h
mdep_raw.o:	mdep_raw.c dbg.h cons.h mididev.h str.h
mdep_alsa.o:	mdep_alsa.c dbg.h mididev.h str.h
mdep_sndio.o:	mdep_sndio.c dbg.h cons.h mididev.h str.h
metro.o:	metro.c dbg.h mux.h metro.h ev.h defs.h timo.h song.h \
		name.h str.h track.h frame.h state.h filt.h sysex.h
mididev.o:	mididev.c dbg.h defs.h mididev.h pool.h cons.h str.h \
		ev.h sysex.h mux.h timo.h
mixout.o:	mixout.c dbg.h ev.h defs.h filt.h pool.h mux.h timo.h \
		state.h
mux.o:		mux.c dbg.h ev.h defs.h cons.h mux.h mididev.h sysex.h \
		timo.h state.h conv.h norm.h mixout.h
name.o:		name.c dbg.h name.h str.h
node.o:		node.c dbg.h str.h data.h node.h exec.h name.h cons.h
norm.o:		norm.c dbg.h ev.h defs.h norm.h pool.h mux.h filt.h \
		mixout.h state.h timo.h
parse.o:	parse.c dbg.h textio.h lex.h data.h parse.h node.h \
		cons.h
pool.o:		pool.c dbg.h pool.h
saveload.o:	saveload.c dbg.h name.h str.h song.h track.h ev.h defs.h \
		frame.h state.h filt.h sysex.h metro.h timo.h parse.h \
		lex.h textio.h saveload.h conv.h
smf.o:		smf.c dbg.h sysex.h track.h ev.h defs.h song.h name.h \
		str.h frame.h state.h filt.h metro.h timo.h smf.h cons.h \
		conv.h
song.o:		song.c dbg.h mididev.h mux.h track.h ev.h defs.h frame.h \
		state.h filt.h song.h name.h str.h sysex.h metro.h \
		timo.h cons.h mixout.h norm.h
state.o:	state.c dbg.h pool.h state.h ev.h defs.h
str.o:		str.c dbg.h str.h
sysex.o:	sysex.c dbg.h sysex.h defs.h pool.h
textio.o:	textio.c dbg.h textio.h cons.h
timo.o:		timo.c dbg.h timo.h
track.o:	track.c dbg.h pool.h track.h ev.h defs.h
user.o:		user.c dbg.h defs.h node.h exec.h name.h str.h data.h \
		cons.h textio.h lex.h parse.h mux.h mididev.h track.h \
		ev.h song.h frame.h state.h filt.h sysex.h metro.h \
		timo.h user.h builtin.h smf.h saveload.h
